# generate-markdown.yml
name: Generate Markdown

on:
  push:
    branches:
      - main

jobs:
  generate:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Generate Markdown
        run: |
          for file in $(git ls-files | grep DECK.md); do
            yaml_file="${file%.md}.yaml"

            if [ -f "$yaml_file" ]; then
              title=$(yq e '.title' "$yaml_file")
              type=$(yq e '.type' "$yaml_file")
              status=$(yq e '.status' "$yaml_file")

              case $status in
                NOT STARTED)
                  color="lightgrey"
                  ;;
                ONGOING)
                  color="yellow"
                  ;;
                DONE)
                  color="brightgreen"
                  ;;
                *)
                  color="gray"
                  ;;
              esac

              title_line="$type $title"

              echo "$title_line ![status](https://img.shields.io/badge/status-$status-$color)
<details $(if [ \"$status\" = \"ONGOING\" ]; then echo \"open\"; fi)>
  <summary>Details</summary>
  <!-- your content here -->
</details>" > temp.md

              cat temp.md > "$file"
              rm temp.md
            fi
          done
